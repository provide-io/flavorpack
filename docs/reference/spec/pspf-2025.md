# Progressive Secure Package Format (PSPF) 2025 Specification

The Progressive Secure Package Format (PSPF) 2025 is a modern, secure packaging format for distributing applications and their dependencies.

## Overview

PSPF/2025 provides:
- **Security**: Cryptographic verification and signing
- **Efficiency**: Progressive loading and caching
- **Portability**: Cross-platform compatibility
- **Modularity**: Slot-based architecture for different content types

## Binary Package Structure

### Canonical Binary Layout

This is the **authoritative specification** for PSPF/2025 package structure. All other documentation should reference this diagram.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Offset: 0
â”‚                                 â”‚
â”‚      Native Launcher Binary     â”‚  Platform-specific executable
â”‚      (Variable size: ~1-5 MB)   â”‚  - Go or Rust compiled binary
â”‚                                 â”‚  - Handles extraction and execution
â”‚                                 â”‚  - Contains signature verification code
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Offset: launcher_size
â”‚                                 â”‚
â”‚       Metadata (Compressed)     â”‚  GZIP-compressed JSON manifest
â”‚       (Variable size: ~10 KB)   â”‚  - Package name, version, description
â”‚                                 â”‚  - Execution configuration
â”‚                                 â”‚  - Build metadata
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Offset: metadata_offset + metadata_size
â”‚                                 â”‚
â”‚         Slot Table              â”‚  Array of 64-byte slot descriptors
â”‚    (slot_count Ã— 64 bytes)      â”‚  - One descriptor per slot
â”‚                                 â”‚  - Fixed 64-byte binary structure
â”‚                                 â”‚  - Contains offsets, sizes, checksums
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Offset: slot_table_offset + slot_table_size
â”‚                                 â”‚
â”‚         Slot 0 Data             â”‚  First slot (typically Python runtime)
â”‚    (Compressed with tar.gz)     â”‚  - Size: slot[0].size bytes
â”‚                                 â”‚  - Operations: slot[0].operations
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Offset: slot[0].offset + slot[0].size
â”‚                                 â”‚
â”‚         Slot 1 Data             â”‚  Second slot (typically application code)
â”‚    (Compressed with tar.gz)     â”‚  - Size: slot[1].size bytes
â”‚                                 â”‚  - Operations: slot[1].operations
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            ...                  â”‚  Additional slots as defined
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚         Slot N Data             â”‚  Last slot
â”‚    (Compressed with tar.gz)     â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Offset: EOF - 8200
â”‚  ğŸ“¦ (Start Magic, 4 bytes)      â”‚  UTF-8: 0xF0 0x9F 0x93 0xA6
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Offset: EOF - 8196
â”‚                                 â”‚
â”‚        Index Block              â”‚  Fixed 8192-byte metadata block
â”‚        (8192 bytes)             â”‚  - Format version: 0x20250001
â”‚                                 â”‚  - Package size, launcher size
â”‚                                 â”‚  - Metadata offset and size
â”‚                                 â”‚  - Slot table offset and size
â”‚                                 â”‚  - Slot count
â”‚                                 â”‚  - Ed25519 public key (32 bytes)
â”‚                                 â”‚  - Ed25519 signature (64 bytes)
â”‚                                 â”‚  - SHA-256 metadata checksum
â”‚                                 â”‚  - Adler-32 index checksum
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Offset: EOF - 4
â”‚  ğŸª„ (End Magic, 4 bytes)        â”‚  UTF-8: 0xF0 0x9F 0xAA 0x84
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Offset: EOF (End of File)
```

### Size Breakdown

Total size: **Magic Trailer (8200 bytes) = Start Magic (4) + Index Block (8192) + End Magic (4)**

The magic trailer is always located at the end of the file:
- **Start Magic**: 4 bytes at `EOF - 8200`
- **Index Block**: 8192 bytes at `EOF - 8196`
- **End Magic**: 4 bytes at `EOF - 4`

### Key Components

1. **Launcher Binary** (Variable)
   - Platform-specific compiled executable
   - Finds and reads the index block
   - Verifies cryptographic signature
   - Extracts slots to work environment
   - Executes the packaged application

2. **Metadata** (Variable, ~10 KB)
   - GZIP-compressed JSON manifest
   - Package name, version, description
   - Slot definitions with extraction rules
   - Execution configuration
   - Build provenance information

3. **Slot Table** (slot_count Ã— 64 bytes)
   - Array of fixed-size slot descriptors
   - Each slot: id, name_hash, offset, size, original_size, operations, checksum, purpose, lifecycle, priority, platform, permissions
   - See [SLOT_DESCRIPTOR_SPECIFICATION.md](./SLOT_DESCRIPTOR_SPECIFICATION/) for binary layout

4. **Slot Data** (Variable per slot)
   - Actual content compressed with operation chains
   - Common: tar.gz for directories, gzip for single files
   - Operations defined in slot descriptor

5. **Index Block** (8192 bytes)
   - Fixed-size metadata and cryptographic data
   - Located at `EOF - 8196`
   - Contains all offsets needed to parse package
   - Ed25519 signature covers entire package except signature field

6. **Magic Trailer** (8 bytes around index)
   - Start magic: `ğŸ“¦` (4 bytes) at `EOF - 8200`
   - End magic: `ğŸª„` (4 bytes) at `EOF - 4`
   - Used for rapid format identification

### Reading Algorithm

To read a PSPF package:

1. Seek to `EOF - 4` and verify end magic (`ğŸª„`)
2. Seek to `EOF - 8200` and verify start magic (`ğŸ“¦`)
3. Read index block from `EOF - 8196` (8192 bytes)
4. Verify index checksum (Adler-32)
5. Verify package signature (Ed25519)
6. Read metadata from `metadata_offset` (size: `metadata_size`)
7. Read slot table from `slot_table_offset` (size: `slot_count Ã— 64`)
8. Extract slots as needed based on lifecycle rules

### All Other Documentation

**All other binary layout diagrams in the FlavorPack documentation should link to this canonical specification rather than duplicating the structure.** This ensures consistency and prevents documentation drift.

## Specification Documents

### Core Format Specifications
- [Slot Descriptor Binary Format](./SLOT_DESCRIPTOR_SPECIFICATION/) - 64-byte binary structure for slot metadata

### Format Enhancement Proposals (FEPs)
- [FEP-0001: Core Format and Operation Chains](./fep-0001-core-format-and-operation-chains/)
- [FEP-0002: JSON Metadata Format](./fep-0002-json-metadata-format/)
- [FEP-0003: Operation Registry](./fep-0003-operation-registry/)

### Future Enhancement Proposals
- [FEP-0004: Supply Chain JIT](./future/fep-0004-supply-chain-jit/)
- [FEP-0005: Runtime JIT Loading](./future/fep-0005-runtime-jit-loading/)
- [FEP-0006: Staged Payload Architecture](./future/fep-0006-staged-payload-architecture/)

## API Reference

For Python implementation details, see:
- [API Documentation](../../api/index/)
- [Packaging API](../../api/packaging/)
- [Builder API](../../api/builder/)
- [Reader API](../../api/reader/)
- [Crypto API](../../api/crypto/)

## Concepts

- [PSPF Format Concepts](../../guide/concepts/pspf-format/)
- [Package Structure](../../guide/concepts/package-structure/)
- [Security Model](../../guide/concepts/security/)
- [Work Environments](../../guide/concepts/workenv/)

## Implementation

- [Packaging Guide](../../guide/packaging/index/)
- [Python Applications](../../guide/packaging/python/)
- [Package Signing](../../guide/packaging/signing/)
- [Manifest Format](../../guide/packaging/manifest/)